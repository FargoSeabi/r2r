{% load static %}
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Buy Ticket â€“ Roots to Realities</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://cdn.tailwindcss.com"></script>
<script>
    tailwind.config = {
    theme: {
        extend: {
        colors: { brand: { 500:"#e2623f", 600:"#cf5536" } },
        boxShadow: { card: "0 10px 24px rgba(2, 6, 23, .06)" }
        }
    }
    }
</script>
<style>
    .card { box-shadow: 0 10px 24px rgba(2, 6, 23, .06); }
    .brand-grad { background: linear-gradient(135deg, #1a1a1a 0%, #2d4a22 100%); }
    .step { counter-increment: step; }
    .step:before {
    content: counter(step);
    @apply inline-flex items-center justify-center h-6 w-6 rounded-full bg-brand-500 text-white text-xs font-bold mr-2;
    }
</style>
</head>
<body class="bg-slate-50 text-slate-900">
<!-- Header -->
<header class="brand-grad text-white">
    <div class="mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
    <div class="flex items-center gap-3">
        <span class="inline-flex h-10 w-10 items-center justify-center rounded-xl bg-white/10 ring-1 ring-white/20">
        <svg viewBox="0 0 24 24" fill="none" class="h-5 w-5 text-white"><path d="M12 2a10 10 0 100 20 10 10 0 000-20Zm0 0v20M2 12h20" stroke="currentColor" stroke-width="1.5"/></svg>
        </span>
        <span class="font-extrabold tracking-tight">Roots to Realities</span>
    </div>
    <div class="text-sm opacity-90">VR Experience Ticket</div>
    </div>
</header>

<main class="mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 py-8">
    <div class="bg-white rounded-2xl ring-1 ring-slate-200 card p-6 lg:p-8">
    <div class="grid lg:grid-cols-3 gap-8">
        <!-- Form -->
        <section class="lg:col-span-2">
        <h1 class="text-2xl sm:text-3xl font-black tracking-tight">Your details</h1>
        <p class="mt-2 text-slate-600">Please complete your information and proceed to secure payment. All tickets are R35.</p>

        <form id="ticketForm" action="{% url 'payfast_checkout' 35 %}" method="post" class="mt-6 space-y-6">
            {% csrf_token %}

            <div>
            <div class="step font-semibold text-slate-800">Personal Information</div>
            <div class="mt-3 grid sm:grid-cols-2 gap-4">
                <label class="block">
                <span class="text-sm text-slate-700">Name *</span>
                <input required name="name" type="text" class="mt-1 w-full rounded-xl border-slate-300 focus:border-brand-500 focus:ring-brand-500" placeholder="e.g. Thandi" />
                </label>
                <label class="block">
                <span class="text-sm text-slate-700">Surname *</span>
                <input required name="surname" type="text" class="mt-1 w-full rounded-xl border-slate-300 focus:border-brand-500 focus:ring-brand-500" placeholder="e.g. Ndlovu" />
                </label>
            </div>

            <div>
            <div class="mt-3 grid">
                <label class="block">
                <span class="text-sm text-slate-700">Email Address *</span>
                <input required name="email" type="email" class="mt-1 w-full rounded-xl border-slate-300 focus:border-brand-500 focus:ring-brand-500" placeholder="e.g. 4E6Y8@example.com" />
                </label>
                <label class="block">
                <span class="text-sm text-slate-700">Phone Number *</span>
                <input required name="phone" type="tel" class="mt-1 w-full rounded-xl border-slate-300 focus:border-brand-500 focus:ring-brand-500" placeholder="e.g. 012-345-6789" />
                </label>
            </div>

            <div class="mt-3 grid sm:grid-cols-2 gap-4">
                <label class="block">
                <span class="text-sm text-slate-700">Gender</span>
                <select name="gender" class="mt-1 w-full rounded-xl border-slate-300 focus:border-brand-500 focus:ring-brand-500">
                    <option value="" selected>Prefer not to say</option>
                    <option>Female</option>
                    <option>Male</option>
                    <option>Non-binary</option>
                    <option>Other</option>
                </select>
                </label>
                <label class="block">
                <span class="text-sm text-slate-700">Age *</span>
                <input required name="age" id="age" type="number" min="1" max="120" class="mt-1 w-full rounded-xl border-slate-300 focus:border-brand-500 focus:ring-brand-500" placeholder="e.g. 22" />
                </label>
            </div>
            </div>

            <div>
            <div class="mt-3 flex items-center justify-between rounded-xl border border-slate-200 bg-slate-50 p-4">
                <div class="text-sm text-slate-700">
                <div>Ticket Price: <span id="priceLabel" class="font-semibold">Standard Rate</span></div>
                <div class="text-xs text-slate-500">R35 for everyone - No age restrictions or categories</div>
                </div>
                <div class="text-2xl font-extrabold text-emerald-700">R <span id="amount">35.00</span></div>
            </div>
            <p class="mt-2 text-xs text-slate-500">Fixed price for all visitors. Final price is confirmed on the next step.</p>
            </div>

            <div class="pt-2 flex items-center gap-3">
            <button type="submit" class="inline-flex items-center gap-2 px-5 py-2.5 rounded-full bg-brand-500 hover:bg-brand-600 text-white font-semibold">
                Continue to Secure Payment
                <a href=""></a>
                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor"><path d="M5 12h12M13 5l7 7-7 7"/></svg>
            </button>
            <span class="text-xs text-slate-500">Youâ€™ll enter your card details on the PayFast page.</span>
            </div>
        </form>
        </section>

        <!-- Helpful panel -->
        <aside>
        <div class="rounded-2xl overflow-hidden ring-1 ring-slate-200">
            <img src="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1600&auto=format&fit=crop" alt="" class="w-full h-44 object-cover" />
            <div class="p-4">
            <div class="font-semibold">What happens next?</div>
            <ul class="mt-2 text-sm text-slate-600 space-y-1">
                <li>â€¢ All tickets are R35 - simple pricing for everyone.</li>
                <li>â€¢ You're redirected to <strong>PayFast</strong> to pay securely.</li>
                <li>â€¢ On success, you'll return to our site with your receipt.</li>
            </ul>
            <div class="mt-4 text-xs text-slate-500">We donâ€™t store your card details. Payments are processed by PayFast.</div>
            </div>
        </div>
        </aside>
    </div>
    </div>
</main>

<!-- Chatbot Widget -->
<div id="chatbot" class="fixed bottom-6 right-6 z-50">
    <!-- Chat Button -->
    <button id="chatToggle" class="h-14 w-14 bg-brand-500 hover:bg-brand-600 text-white rounded-full shadow-lg flex items-center justify-center transition-all duration-200 hover:scale-105">
        <svg id="chatIcon" class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
        </svg>
        <svg id="closeIcon" class="h-6 w-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
    </button>

    <!-- Chat Window -->
    <div id="chatWindow" class="absolute bottom-16 right-0 w-80 h-96 bg-white rounded-2xl shadow-2xl ring-1 ring-slate-200 hidden flex-col overflow-hidden">
        <!-- Chat Header -->
        <div class="bg-brand-500 text-white p-4 flex items-center gap-3">
            <div class="h-8 w-8 bg-white/20 rounded-full flex items-center justify-center">
                <span class="text-sm font-semibold">ðŸŽ«</span>
            </div>
            <div>
                <h3 class="font-semibold">Ticket Assistant</h3>
                <p class="text-xs text-brand-100">Help with pricing & booking</p>
            </div>
        </div>

        <!-- Chat Messages -->
        <div id="chatMessages" class="flex-1 p-4 overflow-y-auto space-y-3">
            <div class="flex gap-2">
                <div class="h-6 w-6 bg-brand-100 rounded-full flex items-center justify-center flex-shrink-0">
                    <span class="text-xs">ðŸŽ«</span>
                </div>
                <div class="bg-slate-100 rounded-lg p-3 text-sm">
                    <p>Hi! I'm here to help with your ticket booking. I can assist with:</p>
                    <ul class="mt-2 space-y-1 text-xs">
                        <li>â€¢ Ticket pricing information</li>
                        <li>â€¢ Payment process</li>
                        <li>â€¢ VR experience details</li>
                        <li>â€¢ General booking help</li>
                    </ul>
                    <p class="mt-2">What would you like to know?</p>
                </div>
            </div>
        </div>

        <!-- Chat Input -->
        <div class="p-4 border-t border-slate-200">
            <div class="flex gap-2">
                <input id="chatInput" type="text" placeholder="Ask about tickets, pricing, or discounts..." class="flex-1 px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent">
                <button id="sendMessage" class="px-4 py-2 bg-brand-500 hover:bg-brand-600 text-white rounded-lg text-sm font-medium transition-colors">
                    Send
                </button>
            </div>
            <div class="mt-2 flex gap-1 flex-wrap">
                <button class="quick-reply px-2 py-1 bg-slate-100 hover:bg-slate-200 text-xs rounded-full transition-colors">Ticket prices</button>
                <button class="quick-reply px-2 py-1 bg-slate-100 hover:bg-slate-200 text-xs rounded-full transition-colors">Simple pricing</button>
                <button class="quick-reply px-2 py-1 bg-slate-100 hover:bg-slate-200 text-xs rounded-full transition-colors">Payment help</button>
            </div>
        </div>
    </div>
</div>

<script>
    (function () {
    const ageEl = document.getElementById('age');
    const desEl = document.getElementById('designation');
    const amountEl = document.getElementById('amount');
    const labelEl = document.getElementById('priceLabel');
    const formEl = document.getElementById('ticketForm');

    function compute() {
        // Fixed price for everyone
        const amount = 35.00;
        const label = "Standard Rate";
        
        amountEl.textContent = amount.toFixed(2);
        labelEl.textContent = label;
        
        // Update form action with the fixed amount
        const baseUrl = '{% url "payfast_checkout" 0 %}'.replace('/0/', '/' + Math.round(amount) + '/');
        formEl.action = baseUrl;
    }

    // Only need to compute once since price is fixed
    compute();
    })();
    
    // Chatbot functionality
    (() => {
        const chatToggle = document.getElementById('chatToggle');
        const chatWindow = document.getElementById('chatWindow');
        const chatIcon = document.getElementById('chatIcon');
        const closeIcon = document.getElementById('closeIcon');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendMessage');
        const quickReplies = document.querySelectorAll('.quick-reply');
        
        let isOpen = false;
        
        // Ticket-specific responses
        const responses = {
            'prices': 'All tickets are R35 for everyone! We have simplified our pricing - no age restrictions or categories.',
            'discount': 'Great news! Our tickets are already at a low price of R35 for everyone - no discounts needed!',
            'payment': 'After filling out your details, you\'ll be redirected to PayFast for secure payment. We accept all major credit cards and EFT.',
            'experience': 'Our VR experience offers immersive 360Â° tours of authentic South African villages. Each session lasts 70-95 minutes.',
            'age': 'Age doesn\'t affect the price - everyone pays the same R35 for our VR experience!',
            'student': 'Students pay the same R35 as everyone else - we have simplified our pricing for all visitors!',
            'help': 'I can help with ticket pricing, payment process, or VR experience details. What would you like to know?',
            'default': 'For specific questions about your booking, please complete the form above or contact our support team.'
        };
        
        function toggleChat() {
            isOpen = !isOpen;
            if (isOpen) {
                chatWindow.classList.remove('hidden');
                chatWindow.classList.add('flex');
                chatIcon.classList.add('hidden');
                closeIcon.classList.remove('hidden');
                chatInput.focus();
            } else {
                chatWindow.classList.add('hidden');
                chatWindow.classList.remove('flex');
                chatIcon.classList.remove('hidden');
                closeIcon.classList.add('hidden');
            }
        }
        
        function addMessage(message, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex gap-2' + (isUser ? ' justify-end' : '');
            
            if (isUser) {
                messageDiv.innerHTML = `
                    <div class="bg-brand-500 text-white rounded-lg p-3 max-w-xs">
                        <p class="text-sm">${message}</p>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="h-6 w-6 bg-brand-100 rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-xs">ðŸŽ«</span>
                    </div>
                    <div class="bg-slate-100 rounded-lg p-3 max-w-xs">
                        <p class="text-sm">${message}</p>
                    </div>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function getResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('price') || lowerMessage.includes('cost') || lowerMessage.includes('ticket prices')) {
                return responses.prices;
            } else if (lowerMessage.includes('discount') || lowerMessage.includes('student discount') || lowerMessage.includes('concession')) {
                return responses.discount;
            } else if (lowerMessage.includes('payment') || lowerMessage.includes('pay') || lowerMessage.includes('card')) {
                return responses.payment;
            } else if (lowerMessage.includes('experience') || lowerMessage.includes('vr') || lowerMessage.includes('tour')) {
                return responses.experience;
            } else if (lowerMessage.includes('age') || lowerMessage.includes('child') || lowerMessage.includes('13')) {
                return responses.age;
            } else if (lowerMessage.includes('student') || lowerMessage.includes('university')) {
                return responses.student;
            } else if (lowerMessage.includes('help') || lowerMessage.includes('support')) {
                return responses.help;
            } else {
                return responses.default;
            }
        }
        
        function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;
            
            addMessage(message, true);
            chatInput.value = '';
            
            setTimeout(() => {
                const response = getResponse(message);
                addMessage(response, false);
            }, 500);
        }
        
        // Event listeners
        chatToggle.addEventListener('click', toggleChat);
        sendButton.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // Quick reply buttons
        quickReplies.forEach(button => {
            button.addEventListener('click', () => {
                const message = button.textContent;
                addMessage(message, true);
                setTimeout(() => {
                    const response = getResponse(message);
                    addMessage(response, false);
                }, 500);
            });
        });
    })();
</script>
</body>
</html>
